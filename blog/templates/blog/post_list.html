{% extends 'blog/base.html' %}

{% block content %}
    <!-- Search Bar -->
    <div class="search-section">
        <form method="get" class="search-form">
            {{ search_form.query }}
            <button type="submit" class="btn btn-secondary">Search</button>
            {% if query %}
                <a href="{% url 'post_list' %}" class="btn btn-clear">Clear</a>
            {% endif %}
        </form>
        {% if query %}
            <p class="search-results-info">
                Search results for "<strong>{{ query }}</strong>" - {{ posts.count }} post{{ posts.count|pluralize }} found
            </p>
        {% endif %}
    </div>

    <!-- Tags Section -->
    {% if tags %}
        <div class="tags-section">
            <h4>Filter by Tags:</h4>
            <div class="tags-container">
                <a href="{% url 'post_list' %}" class="tag-btn {% if not selected_tag %}active{% endif %}">
                    All Posts
                </a>
                {% for tag in tags %}
                    <a href="?tag={{ tag.slug }}" class="tag-btn {% if selected_tag == tag %}active{% endif %}">
                        {{ tag.name }} ({{ tag.get_post_count }})
                    </a>
                {% endfor %}
            </div>
            {% if selected_tag %}
                <p class="filter-info">
                    Showing posts tagged with "<strong>{{ selected_tag.name }}</strong>"
                </p>
            {% endif %}
        </div>
    {% endif %}

    <!-- Posts List -->
    <div class="posts-section">
        {% for post in posts %}
            <article class="post">
                <time class="date">
                    {{ post.published_date }}
                </time>
                <h2><a href="{% url 'post_detail' pk=post.pk %}">{{ post.title }}</a></h2>
                <p>{{ post.text|truncatewords:50|linebreaksbr }}</p>
                
                <!-- Post Meta Info -->
                <div class="post-meta">
                    <span class="post-stats">
                        üí¨ {{ post.get_comment_count }} comment{{ post.get_comment_count|pluralize }}
                        ‚Ä¢ ‚ù§Ô∏è {{ post.get_like_count }} like{{ post.get_like_count|pluralize }}
                    </span>
                    {% if post.tags.all %}
                        <div class="post-tags">
                            {% for tag in post.tags.all %}
                                <span class="tag-mini">{{ tag.name }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </article>
        {% empty %}
            {% if query %}
                <div class="no-results">
                    <p>No posts found matching your search.</p>
                    <p><a href="{% url 'post_list' %}">View all posts</a></p>
                </div>
            {% elif selected_tag %}
                <div class="no-results">
                    <p>No posts found with the tag "{{ selected_tag.name }}".</p>
                    <p><a href="{% url 'post_list' %}">View all posts</a></p>
                </div>
            {% else %}
                <p>No posts published yet.</p>
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}